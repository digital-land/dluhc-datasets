{% extends 'layouts/base.html' %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-l">{{ dataset.name }}</span>
    <h1 class="govuk-heading-l">{{ dataset.records | length }} records</h1>
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    {% if session["user"] %}
      {{
        buttonMenu({
          "classes": "govuk-!-margin-bottom-3",
          "items": [
            {
              "element": "a",
              "text": "Add record",
              "href": url_for("main.add_record", dataset=dataset.dataset),
            }
          ]
        })
      }}
    {% endif %}
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% if dataset.records | length > 0 %}
    <section class="app-table-container">
      <table class="app-data-table">
        <thead class="app-data-table__head">
          <tr class="app-data-table__row">
            {% for field in dataset.sorted_fields() %}
            <th scope="col" class="app-data-table__header">
              <span class="app-data-table__header__label">{{field.field | capitalize}}</span>
            </th>
            {% endfor %}
            {% if session["user"] %}
              <th scope="col" class="app-data-table__header app-data-table__header--ui">
                <span class="govuk-visually-hidden">Action</span>
              </th>
            {% endif %}
          </tr>
        </thead>
        <tbody class="app-data-table__body">
          {% for record in dataset.records %}
          <tr class="app-data-table__row">
            {% for field in dataset.sorted_fields() %}
              <td class="app-data-table__cell">{{record.data[field.field]}}</td>
            {% endfor %}
            {% if session["user"] %}
            <td class="app-data-table__cell app-data-table__cell--ui">
              {{
                buttonMenu({
                  "items": [
                    {
                      "element": "a",
                      "text": "Edit row " + (loop.index | string),
                      "classes": "govuk-button--secondary",
                      "href": url_for("main.edit_record", dataset=dataset.dataset, record_id=record.id),
                    }
                  ]
                })
              }}
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    <p class="govuk-body"><a href="{{url_for('main.schema', dataset=dataset.dataset)}}">View schema</a></p>
    {% else %}
      {{
        govukInsetText({
          'text': 'There are no records for the ' + dataset.name + ' dataset'
        })
      }}
    {% endif %}
  </div>
</div>


{% endblock content %}
