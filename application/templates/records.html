{% extends 'layouts/base.html' %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-l">{{ 'Dataset' }}</span>
    <span class="govuk-heading-l">{{ dataset.name }}</span>
    {# <span class="govuk-caption-l">{{ dataset.name }}</span>
    <h1 class="govuk-heading-l">{{ dataset.records | length }} records</h1> #}
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% set blah = url_for("main.dataset", id=dataset.name) %}
    {{
        appSectionNavigation({
            "classes": "govuk-!-margin-bottom-6",
            "id": "section-menu",
            "currentPath": url_for("main.dataset", id=dataset.dataset),
            "itemsList": [
                {
                    "title": "Records",
                    "url": url_for("main.dataset", id=dataset.dataset)
                },
                {
                    "title": "Schema",
                    "url": url_for('main.schema', id=dataset.dataset)
                },
                {
                    "title": "History",
                    "url": url_for("main.history", id=dataset.dataset)
                }
            ]
        })
    }}

  </div>
</div>
<div class="app-grid-row app-grid-row--space-between govuk-!-margin-bottom-3">
  <div class="app-grid-column">
    <h2 class="govuk-heading-m govuk-!-margin-bottom-1">{{ dataset.records | length }} records</h2>
  </div>
  <div class="app-grid-column">
    {% if session["user"] %}
      {{
        buttonMenu({
          "classes": "govuk-!-margin-bottom-0",
          "items": [
            {
              "element": "a",
              "text": "Add record",
              "href": url_for("main.add_record", id=dataset.dataset),
            }
          ]
        })
      }}
    {% endif %}
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% if dataset.records | length > 0 %}
    <section class="app-table-container">
      <table class="app-data-table">
        <thead class="app-data-table__head">
          <tr class="app-data-table__row">
            {% for field in dataset.sorted_fields() %}
            <th scope="col" class="app-data-table__header">
              <span class="app-data-table__header__label">{{field.field | capitalize}}</span>
            </th>
            {% endfor %}
            {% if session["user"] %}
              <th scope="col" class="app-data-table__header app-data-table__header--ui">
                <span class="govuk-visually-hidden">Action</span>
              </th>
            {% endif %}
          </tr>
        </thead>
        <tbody class="app-data-table__body">
          {% for record in dataset.records %}
          <tr class="app-data-table__row">
            {% for field in dataset.sorted_fields() %}
              <td class="app-data-table__cell">{{record.data[field.field] | replace('-','&#8209;') | safe }}</td>
            {% endfor %}
            {% if session["user"] %}
            <td class="app-data-table__cell app-data-table__cell--ui">
              {{
                buttonMenu({
                  "items": [
                    {
                      "element": "a",
                      "text": "Edit",
                      "classes": "govuk-button--secondary",
                      "href": url_for("main.edit_record", id=dataset.dataset, record_id=record.id),
                    }
                  ]
                })
              }}
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    <p class="govuk-hint govuk-!-margin-top-3">This dataset was last updated 01st January 2023</p>
    {% else %}
      {{
        govukInsetText({
          'text': 'There are no records for the ' + dataset.name + ' dataset'
        })
      }}
    {% endif %}
  </div>
</div>


{% endblock content %}
